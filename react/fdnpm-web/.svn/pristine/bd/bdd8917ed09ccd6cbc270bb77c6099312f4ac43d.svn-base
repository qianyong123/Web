import React, { PureComponent } from 'react'
import { string, object, func, bool } from 'prop-types'
import { Button, Form, Input, Modal } from 'antd'

import globalStyles from '@/global.less'


const FORM_ITEM_LAYOUT = {
  labelCol: {
    span: 7,
  },
  wrapperCol: {
    span: 16,
  },
  labelAlign: 'right',
}

@Form.create({
  mapPropsToFields({ item: { ...rest } }) {
    const { createFormField } = Form
    const files = {}
    Object.keys(rest).map(key => {
      files[key] = createFormField({
        value: rest[key],
      })
      return key
    })
    return {
      ...files,
    }
  },
})
class FormComp extends PureComponent {
  static propTypes = {
    item: object,
    title: string.isRequired,
    modalVisible: bool.isRequired,
    form: object.isRequired,
    submitForm: func.isRequired,
    onCancelClick: func.isRequired,
  }

  static defaultProps = {
    item: {},
  }

  handleSubmit = e => {
    e.preventDefault()

    const { form, item, submitForm } = this.props

    return form.validateFieldsAndScroll((err, values) => {
      // console.log(values)
      if (!err) {
        submitForm(item.id, { ...item, ...values })
      }
    })
  }

  render() {
    const { form, title, modalVisible, onCancelClick, loading } = this.props
    const { getFieldDecorator } = form

    return (
      <Modal
        destroyOnClose
        footer={[
          <Button type="primary" loading={loading} onClick={this.handleSubmit}>
            提交
          </Button>,
          <Button style={{ marginLeft: '16px' }} onClick={onCancelClick}>
            取消
          </Button>,
        ]}
        title={title}
        visible={modalVisible}
        // onOk={this.handleOk}
        onCancel={onCancelClick}
      >
        <Form {...FORM_ITEM_LAYOUT} className={globalStyles.modalForm}>
          <Form.Item label="指标分类">
            {getFieldDecorator('targetSortName', {
              rules: [
                {
                  required: true,
                  message: '指标分类',
                  whitespace: true,
                },
              ],
            })(<Input placeholder="请输入指标分类"/>)}
          </Form.Item>
        </Form>
      </Modal>
    )
  }
}

export default FormComp
